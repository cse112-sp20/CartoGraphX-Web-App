let directoryTree,fileList=[],subscribedFileList=[],editorKeyToNameMap={},fileKeyToEditorsMap={};const DIRECTORY_TREE="/directory_trees/",TEAM_MAP="/team_maps/",FILE="/files/",USER="/users/",DEMO_DIRECTORY_TREE_KEY="6ABDc";async function createTree(){firebase.initializeApp({apiKey:"AIzaSyA8jCEXgEsLljtkEUg-RCgHaF6i2cag_kY",authDomain:"remote-13.firebaseapp.com",databaseURL:"https://remote-13.firebaseio.com",projectId:"remote-13",storageBucket:"remote-13.appspot.com",messagingSenderId:"113160307201",appId:"1:113160307201:web:fc2dda4c33c5d2ce4ff600",measurementId:"G-3F5MRDS2LK"}),firebase.analytics(),dbAccess=firebase.database(),subscribeToChanges(DIRECTORY_TREE,DEMO_DIRECTORY_TREE_KEY,async a=>{directoryTree=a.val(),await generateFileMap(),await subscribeToFiles(),displayDirectoryTree()}),setInterval(()=>{displayDirectoryTree()},1e4)}function getEntrySnapshotWithKey(a,b){return dbAccess.ref(a+b).once("value")}function subscribeToChanges(a,b,c){return dbAccess.ref(a+b).on("value",c)}async function subscribeToFiles(){fileList.forEach(async a=>{subscribedFileList.includes(a)||(subscribedFileList.push(a),await subscribeToChanges(FILE,a,b=>{getEditorsNames(b.val().current_editors).then(b=>{fileKeyToEditorsMap[a]=b})}))})}async function getEditorsNames(a){if("string"==typeof a)return[];for(let[b,c]of Object.entries(a))editorKeyToNameMap.hasOwnProperty(c)||(await getEntrySnapshotWithKey(USER,c).then(a=>{editorKeyToNameMap[c]=a.val().firstName+" "+a.val().lastName}));for(let b in editorNames=[],a)editorNames.push(editorKeyToNameMap[a[b]]);return editorNames}async function generateFileMap(){let a=[directoryTree],b=[];for(;0!=a.length;)for(let c in subDir=a.pop(),subDir)"string"==typeof subDir[c]?(b.push(subDir[c]),fileList.includes(subDir[c])||fileList.push(subDir[c])):a.push(subDir[c]);for(let a in b)await getEntrySnapshotWithKey(FILE,b[a]).then(c=>{fileKeyToEditorsMap[b[a]]=c.val().current_editors});for(let a in fileKeyToEditorsMap){let b=[];for(let c in fileKeyToEditorsMap[a])await getEntrySnapshotWithKey(USER,fileKeyToEditorsMap[a][c]).then(a=>{if(null!=a.val()){let c=a.val();b.push(c.firstName+" "+c.lastName)}});fileKeyToEditorsMap[a]=b}}function displayDirectoryTree(){const a=document.getElementById("tree");str=generateSourceTree(directoryTree),a.innerHTML=str}function generateSourceTree(a){let b="";for(topLevelFile in a)"string"==typeof a[topLevelFile]?b+=topLevelFile+"\n":(b+=topLevelFile+"\n",b+=generateSourceTreeRec(a[topLevelFile],""));return b}function generateSourceTreeRec(a,b){let c=[[" \u251C\u2500 "," \u2502  "],[" \u2514\u2500 ","    "]],d=Object.entries(Object.entries(a)),e="";for(const[f,[g,h]]of d){let a;a=isLastElementInArray(d,f)?c[1]:c[0],"string"==typeof h?e+=b+a[0]+g.replace(",",".")+" "+listEditorsOf(h)+"\n":(e+=b+a[0]+g.replace(",",".")+"\n",e+=generateSourceTreeRec(h,b+a[1]))}return e}function listEditorsOf(a){let b="(",c=!1;for(let d in fileKeyToEditorsMap[a])b+="<span style=\"color:red\">"+fileKeyToEditorsMap[a][d]+"</span>, ",c=!0;return b+=")",c?b.substring(0,b.length-3)+")":b}function isLastElementInArray(a,b){return b==a.length-1}function setFileKeyToEditorsMap(a){fileKeyToEditorsMap=a}testObject={},testObject.generateSourceTree=generateSourceTree,testObject.setFileKeyToEditorsMap=setFileKeyToEditorsMap;