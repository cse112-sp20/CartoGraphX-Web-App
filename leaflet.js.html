<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: leaflet.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: leaflet.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/** 
 *  @fileOverview   Create the map with a non-earth coordinate system. Coordinates are in (y,x).
 *
 *  @author       Alistair Knox
 *
 */

var map = L.map('mapid', {
    crs: L.CRS.Simple,
    minZoom: -1,
    preferCanvas: true
    
});
var absoluteBoundX = 1280;
var absoluteBoundY = 720;
let padding = 150;
var boundX = absoluteBoundX - padding;
var boundY = absoluteBoundY - padding;
var bounds = [[0,0], [absoluteBoundY, absoluteBoundX]];
var usedPoints = [];
var circleRadius = 35;
var initialSeed = 3;
var seed = initialSeed;

var layerGroup = L.layerGroup().addTo(map)

var avatarIcon = L.icon({
    iconUrl: 'img/avatar.png',
    fillOpacity: 0.2,
    iconSize:     [50, 50], // size of the icon
    iconAnchor:   [25, 60], // point of the icon which will correspond to marker's location
});


map.setMaxBounds(bounds);
map.fitBounds(bounds);

/*
 * @param files - Array of file names to add
 */
function filesToMap(files) {
    for (let e of files) {
        L.circle(genNextPoint(), {
            color: '#8A2BE2',
            fillOpacity: 0.5,
            radius: 35,
        }).addTo(map).bindPopup(e.toString()).bindTooltip(e.toString(),
        {permanent: true, direction:"center"}
       ).openTooltip();
    }
}

/*
 * @param fileKeyToNameMap - Dictionary of File keys : file names 
 * Displays editors on the map
 */
function activeFilesToMap(fileKeyToNameMap) {
    for (let [k,v] of Object.entries(fileKeyToNameMap)) {
        let coords = genNextPoint()

        // leaflet glitch doesn't display colors properly
        // if (listEditorsOf(k).length == 0) {
        //     var color = '#FFFFF'
        // } else {
        //     var color = '#00FF7F'
        // }

        var editorString = "&lt;br>Editors: (none)"
        if (listEditorsOf(k).length > 0) {
            L.marker(coords, {icon: avatarIcon}).addTo(map);
            editorString = "&lt;br>Editors: " + listEditorsOf(k)
        }

        layerGroup.addLayer(
            L.circle(coords, {
                color: '#00FF7F',
                fillOpacity: 0.5,
                radius: 35,
            }).addTo(map).bindPopup("File: " + v + editorString).bindTooltip(v.toString() + '\n' + listEditorsOf(k),
            {permanent: true, direction:"center"}
            ).openTooltip()
        )
    }
}


/*
 * Generate a point with non overlapping area. (Constant radius for all points)
 */
function genNextPoint() {
    var point = [random()*boundY + padding/2, random()*boundX + padding/2];
    for (let i = 0; i &lt; usedPoints.length; i++) {
        if (Math.abs(point[0] - usedPoints[i][0]) &lt; 2*circleRadius + 2 &amp;&amp; 
            Math.abs(point[1] - usedPoints[i][1]) &lt; 2*circleRadius + 2) {
            // pick a new point and restart
            var point = [random()*boundY + padding/2, random()*boundX + padding/2];
            i = 0;
        }
    }
    usedPoints.push(point);
    return point;
}

// Source: https://stackoverflow.com/a/19303725
// Generates random numbers from seed
function random() {
    var x = Math.sin(seed++) * 10000;
    return x - Math.floor(x);
}

// Completely redraw map on db refresh
function resetMap() {
    seed = initialSeed
    usedPoints = []
    layerGroup.clearLayers()
}

addListener(onTreeUpdate); // Tell the tree to call our onTreeUpdate method once it
                           // has gotten the tree from the database.

function onTreeUpdate(fileKeyToNameMap){
    // console.log(fileKeyToNameMap)
    resetMap()
    activeFilesToMap(fileKeyToNameMap)
}



</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#colorText">colorText</a></li><li><a href="global.html#createTree">createTree</a></li><li><a href="global.html#deleteAccount">deleteAccount</a></li><li><a href="global.html#displayDirectoryTree">displayDirectoryTree</a></li><li><a href="global.html#generateFileKeyToNameMap">generateFileKeyToNameMap</a></li><li><a href="global.html#generateSourceTree">generateSourceTree</a></li><li><a href="global.html#generateSourceTreeRec">generateSourceTreeRec</a></li><li><a href="global.html#getUiConfig">getUiConfig</a></li><li><a href="global.html#handleSignedInUser">handleSignedInUser</a></li><li><a href="global.html#handleSignedOutUser">handleSignedOutUser</a></li><li><a href="global.html#initApp">initApp</a></li><li><a href="global.html#isLastElementInArray">isLastElementInArray</a></li><li><a href="global.html#listEditorsOf">listEditorsOf</a></li><li><a href="global.html#subscribeToChanges">subscribeToChanges</a></li><li><a href="global.html#toggleNav">toggleNav</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.4</a> on Fri Jun 12 2020 05:41:19 GMT+0000 (Coordinated Universal Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
